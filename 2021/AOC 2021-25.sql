USE [AOC];
SET NOCOUNT ON;
GO

DROP TABLE IF EXISTS [#Input];
DROP TABLE IF EXISTS [#Floor];

GO

CREATE TABLE [#Input]
(
	[id]		int		IDENTITY(1,1)
	,[value]	varchar(MAX)
);

CREATE TABLE [#Floor]
(
	[x]			int
	,[y]		int
	,[type]		char(1)

	,CONSTRAINT [PK_Floor] PRIMARY KEY ([x], [y])
)

GO

DECLARE @inputT varchar(MAX) = '
v...>>.vv>
.vv>>.vv..
>>.>v>...v
>>v>>.>.v.
v>v.vv.v..
>.>>..v...
.vv..>.>v.
v.v..>>v.v
....v..v.>
';

DECLARE @input varchar(MAX) = '
>.v>vv>>..vv>..v.v......>v>>>v.>v.>..v...v......v>....>.vv..>>..>>vv.>..vv>>.>...v...v.....>.vv..>v...>.>>...v>.>>..vv....>>.v.v>v>v>vvv.vv
...vvv.v.vvvv>.v.>..>.>>>v..>v...>..v..>.v>>.v..v.....>v..v.....>vv..vv...vv.v...vv>.v.>..v..v.>>.v>>>v.>>>.v..vv>>.....v.....v.v>>v......v
..v>..v>.>>vvv>>...v.v..>>....>vv>.>v>v..>>>v...>.......>.>>>v.>>v..vvvv...v.v.v.v...>.vv.>>v>...>.....>>....v>..v...v.....v..v>>...>.vv.v>
..>.....>v>.>vv.v..>>>.>...v>.>.v.>.>vvv....v...v..>.......>v>vvvv>>vv>>>.v>v....vv..v..>>.v>>v.>..vv..v.>..>...>....>.>.>.>..vvvv>.>>..>>.
....>.>vv.>.>>.>..vvv.>vv......>...v.v..v..v>...v.v>>..>...vv..>>.>..>v>..>..>...vv.v..v>..v..vvvv..>.v>>.>..>>v.>v>v....>..v..v..>..v>...v
vvvvv.v.v.....v>.vvv.............>vv.vv>v.v..>>v.>..>v>v...>v>v.>vv.>.>......v>vv>.>.>v..v>>>.v>v>.>.v>>.>>.vv.v>>>vvv..>>>v...>.>..>.>.v.v
.v..v>..>.>v.vv.>v>v>.v.v>.>v>>v..>.....v..>>...>v>..>.>>.v>v>v.>>>.>...v>>>.v>>....>v...>.>.>.v>>v.v..>.>v..v>.vv.v..v>.>..v....v>.......v
...>..v.v.v>v.>..>..>.>>>v..vvvv>...>.vv>>..v....>.....>.v>>>v.vv.>v>..v..>>>..vv..>.v..v>..vv.>>.v>v.v>.....vvv>v>v>....>>......v..vv.v>.v
...v.v>..vv>.v.v>v..>.....>v..>>...>>v..v....>v.>v...v.>>..v>..>>..vv......v.>.>...v>.>v...v.v.v.......>..>.v>>..v..v>vv>.v>v.v>v....>..vv.
....>.v..>..vv..>>.>.v>>>.....>>v..v..>.v>...>....vvvv>.v..>.....>..>>v>>>vv....>.v>>.>>.>.v>vv..v....v.>>>.v>.vv...>.>.>>vv.>>.v>....v...>
.>.v>>v>.>.......v.v>v>v..v...v..>>>v.vv.v.vv...v....v>.>>.v..>>>v.>>..vvv.v...v.>vv..>v.v...>..>>vvvv........>v.>....>.v.>...vv..>>....>.>
v>>.v...>v.>....>>.vv...>.>.v....>v.>..v.....v>.v>v.>>.....v>>>v...v..v..>v>.>>.>>.vv.>.v>v>>>>v.>>v.v.v...v....vv...>..v..v>v.>.v>....>>v.
.vv.v.v...>vv..vv.vv.vvv>.>....v....>.>..v..>.v>.vvv.vv>v..v.....v>.v..>..>..v>>...vv>..>...>>.........>..v...v>........v...>....>..>>>vv>.
.>v....>..>v>>.>>>...vv>.v.vv..v....>>>..v.>>>>v.v.>..vv.v.>v.v....>.>vvv.v..v...>vvv>.v.>vv.v..>>>.v>.>...>v.>..v>.vv...>....>>.>v>.vvv>.v
..>.....>v.v..v>.vv...>..vv..v.v>.>.vv.....>.vv..>v>v..v.v.v....>...v.vv.....v.>...>>.>..vv.v.vvv....>v..vv.>....vvvv.v..>v.>...v>>..>>.>..
v.>>..>.vv.>.>....v.vvv.v...vv....vvv..>..v.vv..>>>...>.....v.>>....v.>>>.>>.vv.v.v.v>.v>>.>vvvvv>.>....v>>.>>.v.>.v...v.v>.....vvv>v..vvv>
..v>v.v>.v..v..>.>vvv..vv.>..>v....>....>..>v>v..>>.v>v..v..>v.>>>>.>..v.v.vvv>.>....v.>v...v>>..>..>vv...v.>..>..vv..v.vv..>v.>..>>>>.>>.>
v.>vv..>..v.>vv>....>..v..v>v.vvvv.>..v.v.>v..>..>>....>.vvv>.>>>.v>.v..vvv....>.v.v>v.vv>vv>..v.>v..v..>>...>.....v.>>v.>>>vv>>>v.....v.>v
>>>v>.>>.v>>..>.>>>..>>>.>..v.v.>.......>v>vv>v>.v.vv>v>.>v..v.>v>vv.v.>....>vvv>v.v....v.vv>.v...>>v.>v>>>..vv...>..vv...v.v.v.vv....>>vvv
.>.v..>...>...vv.>v..>..v.>v..v.v>.>...v..vvv.v>>.>vvv>v.v.v>>..>.v>.>.v.vv...v.v>.vvv>..>.>>..vv>....>>.v.>..>...>.>>v.v.v..v.>>..v>.>..v.
.>>.v>>..v>>.>.....v>vv>>>v.....v....v>>..v.v>v.v>vv.>>....v>....>v..>>.......>.>.vv>...>.>>>..v.....>.v.>>>..>v..>>.vv>.>vvv>>vvv........v
...>v>>vv..v.vv>v...v..v.....>>>>.v>>>v>v...>.>v..v.>.....v>..>.v..>>vv..v...>>>vv.>v..v.>>..>....>>.v..>>>.....v..v>>v.>...v>..>>.v.vv.>.v
.vvv...>.v>>..>.....>.>..v>.>.v...v>>..>.>>v..>...>.v.>vvvv....>.v....>.v.....vvvv>v.>.>v..>...v...>>>>...>vv.>>v.v>.v.v.>vv..v.>v.>v>>v.>.
>v.v>..v...>.>>>v.>.>.>v....>v...v.v.....>.>.vvv>.....vv>...vv>...>>.v.v.........>vv>v>..>.v.v>>v>v>.>..v......v>.>>>>>vv..>v.>...>>v..>v..
>..>v.vv..v>>>..>>>v>.>v.vv.vv.>>...v>.vvv..>...>>.vvv.v......v...vvv.v.vv.>.>.>>v>>..v>>...>>>v.v.>....v>.vvvv>>>.vv.v>..v...v.>.vv.v>.>v.
>>v.>>vv>v..v....v>v.>>.>...>.>v...>>..vv...vvvvvv...>..v>...>v.v..>>.>.v>.v.v.>>>.v.>v>>..>.vvv>vv..>v>>..v...>...v.v.>.v...vv...>v>.v..>>
.>.v......>>.v>.>..>..v>vv>...vv.>>v..>..vv.vv..>>..v..vvv..v..vvvv.>.>>......>>.v>>....v....>>.v.v...v.>......>..v>.v.>v>..v.>..v.vvv.v>>.
>..>.v>>.>vv...>>v>>...v.>v.v.>>v.>..>>..>.v..v.vvv>>..>>.v..>..v....v.......>>....vv>.....>>.>.vv......v>vv.v..v>v.......v..>>..v.v>>>v>>v
vvv..>..v>>..v>.v..>.>...>vvv.v.vvv....>.v.>>.>v.v.>.>v.>>vv>v>.v>>..>..>..v.>v.v>..v>>..>.vvv..>v.>.v.v.>vvvv.......v>.>.>..v>>>>>>..vv.>.
....v..vv....>v.>>v.v.>.>v.>..>.>v.v.v>.v...>>v..>..>.vvvvv.>vv.>>>v.v.v..vv.>>.>.>.v.v>..v.>vv..>v..>.v>..>.>v.>v.v...>v.v.>v...v..>vv>v.>
.....>.v.v>>vv.......>.>>.vv>..v...v..>>>..>>v>>...>>..vv>>>..>...v>>>vv...v...>>...v..vv.>v..v>.v>..v..v.>>>.....vv..v...v...>vv..>..v>...
>.>v>.>>.>v>>v.>v.>>>....>.....>>..v>.v.vvvv..>..>v......>...>..vv...>vv.>>..vv..v....>.v..vvv..v>v>...>.v.....>..>.>.>>..>.....>....v>>.>>
vv.vv>>>...>>...>...>..>....v>v.v>.v>v>.>vv>..>.v..>v.>v.v..v..>v..>vv>..v.>.>v.v..>>>v>v.>v...>.vvv>.>>v.>>v>.v>..>..v>....>vv...>v.>>....
>vv.v>v>v>v.>v>v.>v..>vv.v>>.>...v>.v>...v>.vv>......>.v.>....v.vv..v>>...v......vv..>..>v.v>>>......v....>.>>....>.v>vvv.>>........>.vv...
vvv>......v>..>..v>..vv.>...>.>>.v..v>.v.v>v..>.....v..>..>.>>...vvv.>>.vv..v>>...>.>.v..>.>>v..>>.>>v.>.>.v>>>>v.v.v.v>.v....>v..v....v>>.
...v.>vv..>.v.vv>..v..vv..v..v..v..v....>..>v.....v>....vv.>vv>v>...v.>..>...v.>v.>>.v>vv>v>...v>v>>...>..v>.>.>>vv>.v..>>>vvv>..v......>vv
v.v..>v.....>v..>vv...>>..>.v....v>v.v.v..v>>...>>.v.v>...>>>v...>>.>vv...v.v>v....v.v.v...>...vv..>....v>>v>v>.v....v.>>..>>>>>.>.>.>v>.>.
>.v>.vv.>..v...v>>...>vv....v>.>v>v>>v.v.>>v.>>..v...v.........vvv....>.>.....vv.v...>>v.vv.>>vv.>..>.v.>>...>v..v>v.v>>vvv>v.v.>v>.>v>...>
v..v.v.vv...>>.v>..v.....vv>>v>>>>v...v..v..>...>..v>..>>.>>>v...vv.v.v>..>.vv>....v>.v>..vv..>>vv..v..>...>>>v>v.v..>..>>vv..v>.v..v>v.v>>
v...v>v...>v>v>...>..v.>v...v..>>>v>..v.....vv..>....vvv>>v.......>..>>>.v>v.v.vv>.>>>>>vv>>>v.v.>>.v>>.>..v>v.v..>.>>.>v...v.v.>.>.>...>v>
.v.>v..v.v.>.v...>v...>..v>>>v..v>.>v.>v.>...>v.v..>.v>v>>v>.......>>..>v.>>.......>v>..v>.vvv..vvv.v.......>....>v>.....>...v>.v>>>.>v.>.v
vv....>v.....vvv.>.>vvv..>......v>>v.>v>.v.v.vv.v>v.v......v.>v>>vvv>v.v.>..v>vv.>.v........>...vv>v>......v.v>>>.>.v>>>v.vv...>>...v>.>..>
.v..vv.>.vv....vvv>.v.....v>v>.v>..vvv..v...>>..v..>>.>>v..v.>vv...>>>....vv>.v..v..vv..>.>>>...>>v..>..>.v>.vv>..v.>v...>.v>.>..>vv.v...vv
>....>>>v..v>v..>v......v>>>.>..>.vv.>...>.>>>>>v..>v>..>>v......v>v...v>...v...>.>.>.v.v>v...v...v>..v>>v...>.v>>...v...>>..>.>vv>..>..vv.
.v..v........v>.>.v>v.v>.>v.v.>>>..>..>.v>.>v>vv.v.>v....>.v.vv.>..>v>vv.>v.>..>.v..v..>v....v>vv....v.>>.>....v.>>.v...>v>..>...>...v.v>..
>>.v.>.v>.>vv...v>>v>..v.v.>v>.>....>>>..>.v>>v.v.....v.v.....>>...v>>.vv>......v>>>.>.>v>v........>....v>..v.>.>..>>.....>v>vvv.>..v.>>..v
.v.v..>>.vvvv..vv.>.v.v....>.v>..>v.>v.v>..v....>>>.>>>>.....>.v.v>>v>.v>>v>..>.vvvvv.v>vv.>.>v>v>>v.>........v>.v>.>>v..>.vv>>>>.>.v..>.>.
.v...>v.v..>v.>v.>>..vv>v>.>v>.v.>v....>.....v>...vv>v.v>v>..>v>.v.>...>>.v...>>vv>..v.>>v>......v...v.........v.>v>..vv..>.>..v......v>...
......v..>v..>...v>.>vv>...v.v..v.vv.v.>..>v.vvvvv.>..vvvv..>vv...v>...v>>>.......vv.>.>.>>....>..v.>>..>>...>>>.>.vv.vv>v>>..v>.>..vv.....
..>v.......v.>vvv>..v.v...v>.vvv.>v.v.>...v>v>>.>.....v>>vv.>.>...>v..>.v.vvv>>.vv.>v...>v.>..v.v.>.v>.>.>.v.v>v..>..>...vv>>vv.>>>..>v..vv
.>>.>v>>>....v>...>.v>v>>>.....v.v>..v.v..v.v>>v.v>v..>v..v>..v>v>.v.>>.v.>>v>.>v.vvv>..v.v.......v.>>.vv>>>>v...v.>>....>.>>vv>v..vvvv>..v
.....>...v..v.......v.vvvv>v.v..v..v>>v>..v.v...v>..>..>>v.....>>...v.vvv.>v.v...v>>..>v.>.vvv..vv..>vv......v.v..>..>...>v>>v.v..v....>..>
....>..>....v....vv>..>..>v>.>>>v...>v>>..v>.>v...vv>.>.v.>.vv...v>.....v.....v.v..v..>..v>v....v.v>>>>..v...v.vv..>...v.>>..v>.v.v.>.>>.>.
.vv....v.>>>>v>..v..>vvvv.v.>v.vv.v>..v...>..v...>>>.v>.vv>.>>.v.>v.>..>v>...v..v.>...v>.v...>>.>...>....>..v.>...>>.>.v>.vv.v>v.vvv.>.>v>.
>vv..v>.v....v.vv..v>v.v...>.>...>v..v>>.vv.vv.>..>>.>..v...>v..>v>......>.>...>v>>vv.vv>v.v>vvv>...>......>>.....vvv....v>.vvvvv>>vvv>.>v>
>vv>v.....>.v.>.>v..v.v.>..>.>>...v.v.vvv.>..>>..v...>vv.>.v>.v.v>....v..v.>v>...>>.v...v.vv>.>v.v..v.v.>..>>.vv.v>vv...v>v..>..>>.vv>..vv.
.vv.vvv>..vv.>>...>..v...v..v.....>>..>>v..>vv.>...>>...v>>v.>.v..v>v>vv.>.v>v..v.>vv.v.>>>>v>...>..v..>>>.>..v>.>..vv..>>.v.>vv.vv.>>.>..v
v>..v>.v.....v......v..>...v>....v>v.>...v...>.>>.....>v....>v...vv>>v>>..>v.>>.v..v....v.vv..v>..v>v>.v.v.v>v....>..>vvv.vv>v>>..>.>.vv>.v
.>.>..>>....v>...v..>v.>v..>.v>v...>v>..>>v>...............>vv.>>.>..>..v.>.>.>..v>>v>.>.>>>>v>..v.>>>v.v.>v>v.v.....v>>..v>..v.>.....>v.v>
v..vvv..>>v.>v>...>....vvvv...>v..vv.v>.v>.v>>>.v.v.v..v..v.v.>..>>.v..v...v.v.....>.>..v..vv.......>v>.>>..vv>>>v.>.>..v..vv.vv.>.>v>.....
>......>.>.>v..v>vv.v..v>.>..v.......v...v..>v>>>>v>.v.v....v..>.>>v...v.vv..v..v>>>....v...v.>>>>vv..>..>v.......>.>>...>v>>v>..>v..v..v.>
>..v..v>.....>v>.>v...v.>>vv..v.vvv...v..v.....v.v.v>>..v..vv.v>v.v.v...>...>.>.....v>..>..vv>vv....>v.....>..>..v>>v.v...v.>>v....v>>>.>>>
>v>>>v.....v.v.v.v.>v.>.>.v.......vv.>>.vv...>...vv..v..>.v..>.>>...vvv.>vv>..vv.v.>>>v>>vvvv>>v.>.....>>v....v..v....>.v>.>.>>v>.v>..>.>v.
v...vvvv...vv>.v.v...vvv>.v>>...v..........>.v>>..>v..>>v..v.v>.v.vv.>.vv...v....v..>...>..>..>v.>vv>v.vv>.....vvv.vv......>.v.......v.>v.>
...v..>v..>...>>>vv..vv>>.>.>>vvv..vvv..vv.v>v.v..>....>>..>.v.v>..>>>v>>.v...v.>.v...vv..>>>.v>..>..v>>v>..>..>..vv..>..>.vv..v..>>.v.v...
v>>>.vv>.vv.>v......v..>v..>>..v>v..v..vv.>>.>>v....vv>v>.>>.v>>>>.v>....vv>>v.>...>v.>>vv.....>....v..vv.v.>.>>.v.>v.vv.>>.v...>vv.v>>>...
>vv.>v..>..>>.>>>.v...v...v.>.v..v>..>>>v>..v.v.>.>..>..>.>>>>.>v...>.>...>.....v..vvvv.vv>>....v>..v..vv>..v.....>>...>.v...>.>>.v...vv...
v>>>...v.vv..vv..vvv...>.>v.v.>>...>...>.v...>v>v.>>>..vv>>v.>>>.....vv.>..>.>v>>v>>..>.>>.v.v.>.>.v.>>..>>>..v.>...v...vv.v>.v>.>.......v.
.....>..>..>>.....>.>>v.v>>..>>v>>.v..v..vvvv.>.v.v...>..v.v>....vv>>.>.>v..v..v...v..vv>>..v....>..>.v...v.v....v.....vv>>>>v......>..>.vv
>..>..v.v>.>>v>...>v..vv>.vv>v.>vvvvv>.v.v.v...v.>v.>..v...>.>.>.v>>.>.....>>.>.v.v>.v....>.vv.v.>.>v>>v.v>>>>.>v.>>..>vv.vv..v>v.>v.v.v.v>
...vvv>>v>>.v>....>.v.vv..>vvvv.>.>>.v.>>.v....>..>v.>vvvvv.....v>>v..>>v..>..vv..>vvv>.>>>..>.v...vvvv.v..v..v..vvv.v....>v...>.v.>......>
>..v.....>.>.>.>..vvv.>>>.....>.vv>.v>.v>.>.>>>..v..vv.v.>vv..v>..>.v.v.v..vv..>.>.>.v..vv.vv...vv>v>.>>.>>>vv....>..>v>.>.v>.>>....v...>..
...v.v..>>.v..v.v>.v>>....vvv.>v.....>.v>>.>>...>.>....>..>>>...v>vv.v>..v>v.>>v...>v>.v>v>>>>.vv...v..>>..>.>...>..>.vv...>.>..vvvv.>..>.v
>v.v.v..v.v.v..vv.>.>...>.v>>.>.>vv>.>>v>.>>.v.>.v.v>..v.vv.>.v...v..vvv...vv..>.>>.>v.vv...>vv>.v>>>.>>..>...>.>v..v>v>..v..v.v...v.>v>.vv
..v.v...v....v..>vv>vv>v.>vv>....>.>>.v>..v.>v...>>>v.>...>...>..>.>...vv..v>v.>>>v...>...v.v.>...vv....vv.v.>.vv...>v.v..vv..>v.....>>>vv.
>.>.>>>..>>>.>>>v>...>.v>vv.....vv>..v...>.v.v>>v.>>........>>.v>v>v.....vv......>.v.>.>>>v>..v>.v...v..vv>.v.v>>....>.v>...>..v>v>v>...>..
v>>vv.>>>>>v>>.>v.vv>.>.>.v>vv..>v.>vv.>v....>.>...>>>v..vvv.....vv..>v...vvv..>v..vv>.>>>>.>...>>...>>>.v....v.vv>..vv.v..>v...v.>.v.vv..>
>.>>>v........>.v>...v>..>.>.>>vv..>..vv.>.v..v>vv>..>...v..>.>v>vvvv>>v.>>.>..v..>v..v.>>.v>v>..vv>.>v.>.....>.v>>.vv.v..>..>....v.v....>.
.v>...>.v.>.>.>v.>>......vv.v>>.v>.v...>>>...v..v..>.....>.v.vv.v..v.v>..v>......>.v.>>..vvv.v.>v.>..v>vvvv>>.v.v.v.v......v...v.v..>v...>v
>>.vv..>.v.>>>>>..v...>.>.v.>>.>vvv.>>>.>..>v......>>v.>.>.v>>.v...>v>v..v..vv..>....v..v...>>...>v.v.>>..v>v...v..v>..>.v.>.>.>v.>.>.>.>v>
.v.>.>>vv..>...>..v.v.>.v>v>v>....>>>>.>>....v.v>v.>v...v.v..>v>>.>.>..v.>>.vv.vvv.v..v>>>>v...>v>>.>......v...>.>....vvv.>..>.>...>..>.>vv
.vv...v.v.>v>...v.vv..vvv>>.......>.>....>vv.v.......>vv>v.>....>.v>.>.>.v.v.v..v.v.>...v>..v.vv...>v..>v>v.>v>.v.vv..v>.v..v.v>....vv.vvv>
vv.>....vv.v>.v.v.vv..>v.vv>..v.v>..v.vv.v..v.v.>.>.....v>.>....v>.>v...vv>.v>.v>...v>>..v>>....vv.>....v>.>>...vv>..>.>...v..>......v.vvvv
..v.>vvv.>.v.>>.>.v.>.v>>...>>..v>>vv>.vv.vv>.v.vv>>.vv.v>..vv>>v....v.>...v>>..v..>v.>>v>v.>...v......v...>v.>........v.>>...>vv...>.>v.v.
>.>>v>.v>>>..>v..>v>>v.>.vvv..v.>..>.v..v.........v>v.>..>v>.>v.>v>.vv....v..vvv........>>.>>.>>>>..>.vv>..v...>.>....vv>v...>v.vv>>>>>....
.vvvv>..v>.v.v.....v>vv..v.vv>vv>v.v.>v...v>>v..>..>.vv>vvv>.v..>v>vv>......v>.>.v.v...vvv.v>>>.>..>vv>>.v.>v.>...>>.v>>v>>.v.v>>.v>v..>.v.
v.v...vvvv..v.v.>v>...v>.>..vv.vvv>>>....>v.....v>.>vvvv>vv>>.>.v>>.v.v..>..>v>>>vvv>.>>..>.>>..>vv.>v.v...vv.>v>vv..v.>>>.>v>..v..vv>....>
.vv..>vv..>..>.>.v>.>.>>..>..>.>...>>v.>>.>.>vvv>..>v.>.>v......>>.>....>.v.>>vv.v.>vv....>vv..v.>v.v.>v>>.vv..>.v>>..v.......>.v>>.>..>v.>
>v>..>.v>>.>.v..>vvv....v.>..>.vv.>...v>>..>..v..vvv>v>>.v.vv>>>v>>>>>.v.>vv.>..v>.>...vv.vvvv>vv.>vv..vvv..v...>.>.v..>..>v>>>v....v>>.>.>
v.v.vv>.>vv.>>....vvv.v>.>.>..v.>.vv..v>>..>>v>>.vv..v..>vv>>.>.>..>>.v>..>..vvv.>..vv.....v>>>.>.v..v.....>..v>>..v.vvv.>.vv....>>v..v>.v.
>>>...v...v.vv..v..vv..>.>..v....vv...>vv>>>v..v>..>v.....>vv.v..vv>.vvv..vv>.v>v>.v....>v...>.vv..>....v.>vv>.>vv..>.vv>...>v.>v..>v>..>.>
..>.....>.>..>v.>..v>>.v>.>....>..>....>vv.v...v..>>v..>.>.>>.>....v.>>v.....>.>....v.v>..v.....>.>.....v>>.>v>.v.vv.v>v>...>.vv>..vv...v>.
.v.....>>v...>vv>>v.v..>..>.>v>.>.>>>vv.v>.v>v......>.v....>.>>vv..>v..>..v...v.>..v>v..>..v...>.>.v>.v>..v.....vv.vvv>..v>v...vv.>.>...>.>
>.......>..v.v...v>v.v..v>v.vv..>.>>>...v..v..>>>.v..>..v>..>..v..>.>.>.v..>>.v>.v..>vv>v.v.vv>..>.v..vv>vv.v.......>.v.>...>vv..>.vv.....>
.>.>..>.>vv.>v.vvvv.>>>.v.>.v..vvv>>>>...v..v>v..v.>.>.v.v.vv....vv......vv..>.>>>>..vv..>>v>..v>>>>v.>>..>.>v.v.>...>>>..v.v.>.vv.>vv.v>..
..v...v>...>..>.>...>v.>v.........v..>>v....>>>.v.>v>.v..v>>>v....vv..>..>v.v.>.>....v..vvvvv..v.v.vv...v.>vv...v>>>>..vvvv..>>>v..>vv>...v
.>v>.>.>.v>>.>>..v>...vv.......>..>...v.>v.>.v>.>vv>>.v.v.vv...v>....vv>v.v...>v..v.v.v>>v>v>>>......>v..>...vv..>.>.>..v.>>>v....>v.>.>.vv
>v....v.v..v...>>.>v.>>.v>v>....>>.v>>v.v>>v>vv>v.>>..>..>v....>vvv.......v..v>.>>v.>>v.>...v>..v..>vv>v.v>.v......v.>.vv>>>.......>v....vv
.v>>.>>>.>.v.>...v..>>>.v>v.>.vvv>.>..>..v..>v.v..>.>...>vv.v.v.>..>>v>.>v>.v...>>>>v.vv.vv>>>v.v.>vvvvv>>>..v>>....vv>v.>v>.v..v...v..v>v>
...vv.>......v..>v..>..>.>.v>.>>.vvv>>>v>v..>.vv....>>v>..v..v>.v>>.>>.>..>v.>>.v>.>.>.....v..v..v.>>....>v..>.v......v>.v..>>vv...>vvv.vvv
v.>......v>.>.v..>vv>v>.>v>...v..v>>v.vv....v>vvv>.v.v....v.v>....>.>v.vv.v>>>.>>>>v>>v...v...v..v>.v>>vvv>vv.v.v..v.>v..vv>.v.>.v..>vv.>..
..>>>v>>...>.>.....>v>vv>v...>v.v>v>>.v>>>v>..>v.....vvvv...v..>>.v.v>..>.>.>vv...vv...>>.>....>>v.>v.>.>...>v.....vv...v>....>v....v..v>..
..>v..vv.>...v..v.v..v.v>vv......vv.v.....v.>....>...>v......v...v>>...>..>......>>.>>..vv>...v.>.v.v>>>v.....>>.>>...vv.>.>.>vvv...>>>.v..
......v.>>.v>>vvv.v>..>v.>.vv....>v>>..>vv>>>.>.>..>....v..>vv.v..>v>..>..v..>v.>.>.......>>>v.vvv...>..v....>>v.>>>....>v..>.v>>>..vv>>v.>
.>....v.vvvvv>>v..v...vv.>.>.v.>>...>.>.>v.>v...v.v>.>.>>>..vv>.v>vv..v.....v.v.v.>>vv>v>>.v....v...v>v...v>v.v>>..>...>v.v.v.v...>v.v..v.v
...>...>.vvv.v.>..>v>..>v.>>.>v..v.vvvv...v..v.v.>vv.vv.v.>...v...vv....>v>.v.>>v.v.>>>v.v.>...v>>..>v.>v..>......v>>.>..v.v>>v>v..>..>>.>.
.v..v.v.v>.>...vv.v...>.>vvv>...vv......>v.v......v...>..v...>..v>..vv>v>>v>>.v>...vv>.>.v.>vv>v..>v.>.v..v.>..>..>...v.>v.v..v.>>vv.vv>..>
.v...v...>vv...>v.v>>v.v.>v>.v>>v...>vv......>......>..v.vv...v.>>..v..v>>.v.v>v.>>.vv>>..>..vvv...>.v.>>v...vv>v...>.>.v.....vvv.vvvvv>.v.
v>>>>..>.v>>>v>...v..>..>>>v>>..v>.>vv...>v>>.>.v.....>v..>vv...>v.>v....>vv>...vvv.....v..>vv.v.v.v>.>v....v....vvv>.>>..>v.....>v>.v.v>..
.>..v..>>v.vvvv>>.>>>vvvv.>>.v....>.>>.>vv...>.....v..v..v.vvv..>>..>.vv>v...v..v>>v>>.v.vvv>v>.>.v>...v..v.vv....>>.>.......>..v.>>v>...v>
.>..v.vv>.v.>.v.>v.>v..v>..>.>.vvv..v>>..>.>v.vv>v....>v>..>.v>v>..>v........v.>vv...>.vvv>......>>.v.v...>v...v..>v...>v>.v..>.>>>.>.>....
...>...vv.>v>..>.>.v.v>>>>>>vv>...>v.>.>v...>>.>.>v..v.v.>......v.vvv..>...v>>v>..vv>.....>..>>v...>>>..>.>..v..v>v.vv.>...v.v>>.>v....>>..
....>.vv.v....v.v>.v>v.vv...v>.....v>.>v.vv.>v.>..>vv..v.vv..v>.v>....>..vv>v>v>v..>>.v....v.v>..>..v.>>..vv>>v.........>v>.>>.v.>..>.vv>..
>.v..v.>...v...v>>v>>.v.vv>>>........>v>>.vv.v>.>.>.>..v....>vv.>.>....v.>..>.v.v.>..v.v.>v>v.>>>..>>.>.vv>v.>>>.........>..v>v.v.>>v.>>>.>
..v..v..v.v>...v>v..>....>........>v.v>v.>>..v...vvv....>.>>v....>.>..>.>...vv..>>v>v>.>>v..>>...>....vvvv>...v.v.v.>...>>........>.>...>..
...>.vv.>>....>.>.v>...>>>>>v..v....>..v.>..v...>....v..>.v>.v>vv.>v>....>...>.vv..vvv.>vvv>>.vv.>>>.v.......v.>>>>..>...v.v..v...v.v..>v>v
vv....>..vv>>>>vv..>>>.>....v..vv....v>..vv.>.>>..vv.>.v.....>.>.v>...>.v.>v..>.>..>>>..>.vv>>v>.v>.>>.....>.>.v.>..>..vv.>....vv>>>>>>.v>v
.v>>v.vv......v.>>v....>.>.>v..v>v..>>.>>>.vvv>...>...v..>..>>.vv>.>...>>..>>.>.v..>>v..>>..>.v.v>v>.>......>v>v.>.v>v>..v>......v...>v..vv
.v.v.v..v.v..vv>v..........>....vv>v>.v.v>...v>v>>.....v...vv>..vvv>.>....v.v...>>.v....vvv>.vv....>.>>..v.>.vvv>..v..v.>.>..>v....>.>>>>>.
vv..v.........>>v.v.v.>vv>>.v.vv....>v.>>>>v...>>vv.>.v>...vvvvv..>.>>vv.>v>vv...>..v..vv>..>>>v>.v.>vv.>.>.>..>..vv..v>..>>.v..>.>vvv.>...
.vvv>>vvv.>>..>...>v>>.vv.>>..>>v.vv.vvvv.v>vvv.>...>>....>..v..v>>v.v..>>>...>.v.v>vv...>>..vvvv.>v>v.v..>.>...v..v>v.v>..>...vv>..>....>.
.v>.>.>>>.>.v.vvvv>.>v>..>.vv.>.>>...vvv.v.....v>..>.>.>vvvv>>.>.>.v.v>>vvv>..>..vvv>>vv>>.v..vv>>v...>>>..v..>>..>vv....>>.v>.....vv......
.v.>v.>vv.v.v..v>....vv.>.v.v>>>.......v.>.>>.v...v>.>...>....vvv>.vv>v.....v...v..>..>....vv.>.....v>.v.>.>..>vvv.v.>..vvv.>vv...v......v>
v>....v>>.v>.vv>vv.>.>..>>...>v>..v..v......>v>...v..v>..>.>....>.>.v.v...v.v>>.vv.vv..>.v>...>>..>.>v.....v..>>..>>>..v..>...>v.v.v.>>.v..
>..vv.v.>.....>...>v>>>...v>>.vvv..>.>.>...vv>>....>.>.>v>>>.v..>v>vvvv>..v>v.v..>v>.v>>>.>>..v.v.>...v..v.v.>>.>.vv..v.vv>v..v......>v.v>.
vv.>....>.>v..v>.vv.>...>.......v>.>v.>.>.....v.v.>.>.>v.>>vv...>.v>.v...vv>.v.vv.v..>vv.>...v>.>..>>>v>.>v..>v.......>>v>v.v....v..v>.>.>.
v.>>..>vv.v>.>....v..>>>.>>...>.......>v.v.>>.>.>..v.v..>>v.>v.vv...>>......vv>>.v.v>..v>.>..>....v>>.>v...v.vv.>.>>.>>>vv>...v.>...v......
.....v.>.v....v...>..v>v..>.v>..>.>v.>>>vv.>>v>.vv.>....>v.>.v..vvv>.>.>.vv.>...v>>.>.vv>.v.....>v..>v.v...>.>>v...v>vv.v.v.v>>>v>...>.>.>>
v.>....v>>..>v.>.vv.>vv.......v..>.>v.>.>.v..v.v>vv.....v....vv.>>..v.>v...v>.v>.vvv.....>>v>.>.>v............v.>.....>.>...>>.....>.v.>>v.
...>>>>>v..>...v...>.vv.>..vv.v..>.>>..vv.v.>>.>>....v.>vv>..v.>>>.v.>.>.v>..vvvvvv..v>>>..>>...v>.>v..vv........>>v>>.>v>..>v>.>..>...v.v.
vv.>v>v>>>v.v.v.>v>>vv..v>.>v.>..v>....>.vvv........>>v>..>v>.v..v.v>v>.v>.vv.vv>v>>v..v.v>.v>>v...>>.>>>...>>>v.vvv>.....>...v.vv>..>v>.v.
...v...v..v....v.>v.>v.v>..>vvv...vvv..>>v.>.>.>.v.....v>vv.>v.v>>.vvv.v>v.vv.vvvv..>.>...vv.>....vv.>v.>..v......vv>.v>.>..>v.v>v...vv.v.v
vvv>.v>......v.v.v..vv.>v..vv>.....v.>.vvvv>.v..>v..v>v>vv>.>.vvv.>>v....v>>>v>vv>v.......>....>.>...v..v.v....v..>>v...>>>.v.v..v..>v>vv..
>>v..v..vv.vv>.>...v>>>.vvv>>>v..v>>.>>v..>.>>.v.v.v..v.>v..v.>.>v>>.v...>v>>....>vvv>>v>v>.>.v...v.v.>>>....>.>>v>...v.>.>....>.vv.>...v.>
v.vv.......vv.>......v>....v..>v......vv>.v.....v.....>..v...>v>.vvv.vv.....vv>.v>v>..v....>v....>>....v..vv>.v..>>.>>...>.>.vv...v>>..vv.v
v..>>>...>>.v>>...>..>.v>v>vv.>......vv...>>...>v>....>v>.>.>.v>.>....v..v.v.........>>>.....v.vv.....>v>>v>vv.>>..v.>v>...v>>v.vv.v.>.>.>v
...v.vv>..>vv...v>.>v.v>v...vv.>v..v.....v...>....>>>>>..v.v>...>..>.vvv.vvvv>..>.>.v>.vvvvv...v.>v....>.v>vvv..v.v...>.v>vv>>..v.....v>>>.
';

INSERT INTO	[#Input] ([value])
SELECT	[value]
FROM	STRING_SPLIT(REPLACE(@Input, CHAR(13), ''), CHAR(10))
WHERE	[value] <> '';

DECLARE	@y		int	= 1
		,@x		int
		,@line	varchar(MAX);

WHILE @y <= (SELECT MAX([id]) FROM [#Input])
BEGIN
	SELECT	@line	= [value]
	FROM	[#Input]
	WHERE	[id]	= @y;

	SELECT	@x = 1;

	WHILE @x <= LEN(@line)
	BEGIN
		INSERT INTO [#Floor] ([x], [y], [type])
		SELECT	@x, @y, SUBSTRING(@line, @x, 1);

		SELECT	@x += 1;
	END

	SELECT	@y += 1;
END

DECLARE	@maxX		int
		,@maxY		int
		,@round		int	= 0
		,@movement	bit	= 1;

SELECT	@maxX	= MAX([x])
		,@maxY	= MAX([y])
FROM	[#Floor];

WHILE @movement = 1
BEGIN
	SELECT	@movement = 0;

	WITH [EastMover] AS
	(
		SELECT	[ThisX]		= [F].[x]
				,[ThisY]	= [F].[y]
				,[NextX]	= [Next].[x]
		FROM	[#Floor] [F]
		CROSS APPLY	(	SELECT	[x]		= IIF([x] = @maxX, 1, [x] + 1)
					) [Next]
		CROSS APPLY	(	SELECT	[type]
						FROM	[#Floor]
						WHERE	[x]	= [Next].[x]
						AND		[y]	= [F].[y]
					) [Space]
		WHERE	[F].[type]		= '>'
		AND		[Space].[type]	= '.'
	)
	UPDATE	[F]
	SET		[type] = IIF([M].[ThisX] = [F].[x], '.', '>')
	FROM	[#Floor] [F]
	INNER JOIN	[EastMover] [M]	ON	[M].[ThisX]	= [F].[x]
								AND	[M].[ThisY] = [F].[y]
								OR	[M].[NextX]	= [F].[x]
								AND	[M].[ThisY] = [F].[y];

	IF @@ROWCOUNT > 0
		SELECT	@movement = 1;

	WITH [SouthMover] AS
	(
		SELECT	[ThisX]		= [F].[x]
				,[ThisY]	= [F].[y]
				,[NextY]	= [Next].[y]
		FROM	[#Floor] [F]
		CROSS APPLY	(	SELECT	[y]		= IIF([y] = @maxY, 1, [y] + 1)
					) [Next]
		CROSS APPLY	(	SELECT	[type]
						FROM	[#Floor]
						WHERE	[x]	= [F].[x]
						AND		[y]	= [Next].[y]
					) [Space]
		WHERE	[F].[type]		= 'v'
		AND		[Space].[type]	= '.'
	)
	UPDATE	[F]
	SET		[type] = IIF([M].[ThisY] = [F].[y], '.', 'v')
	FROM	[#Floor] [F]
	INNER JOIN	[SouthMover] [M]	ON	[M].[ThisX]	= [F].[x]
									AND	[M].[ThisY] = [F].[y]
									OR	[M].[ThisX]	= [F].[x]
									AND	[M].[NextY] = [F].[y];

	IF @@ROWCOUNT > 0
		SELECT	@movement = 1;

	SELECT	@round += 1;
END








select @round




select @y = 1
while @y <= @maxY
begin
	select	@line = ''

	select		@line += [type]
	from		#Floor
	where		[y]	= @y
	order by	[x];

	print @line;

	select	@y += 1;
end

